<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="context/@@standard_macros/page"
      i18n:domain="plone">

<head>

<body>
<div metal:fill-slot="body">

<div metal:use-macro="context/document_actions/macros/document_actions">
    Document actions (print, sendto etc)
</div>

<h1 i18n:translate="heading_currently_assigned_shares">
    Sharing for
    "<span tal:content="object_title" tal:omit-tag="" i18n:name="folder">title</span>"
</h1>

<p class="documentDescription">
    You can control who can view and edit your item using the list below.
</p>


<!--
  Comments:
  - This form is totally non-functional at the moment, use folder_localrole_form
    if you want to get the code from the earlier version. It had so much crap in
    it that the only thing that made sense to me was to start from scratch :)
  - The list of roles will most likely have to be a whitelist of roles we want
    to be accessible as local roles. 90% of the roles do not make a lot of sense
    as local roles.
  - "Everyone" in the table below == Anonymous. It should be possible to give the 
    reader/editor role to anonymous users. We might have to make this a global 
    option, since it is a bit scary, and you wouldn't want it available in an 
    intranet, for instance. We can drop this feature if it's painful for 3.0
  - "Logged-in users" == Member role or Authenticated, not sure what makes most 
    sense
    ~limi, Dec 16, 2006
    
-->

<form method="POST" 
      tal:attributes="action string:${context/absolute_url}/@@sharing">
      
      <input type="hidden" name="form.submitted:boolean" value="True" />

<table class="listing" 
       summary="Current sharing permissions" 
       tal:define="available_roles view/roles;
                   num_columns python:len(available_roles) + 1;
                   role_settings view/role_settings"
       i18n:attributes="summary summary_assigned_roles;">

    <thead tal:condition="python:len(role_settings) > 0">
        <tr>
            <th i18n:translate="label_name">User/Group</th>
            <th class="nosort"
                tal:repeat="role available_roles"
                tal:content="role/title"  />
        </tr>
    </thead>

    <tbody>
        <tal:entries repeat="entry role_settings">
            <tr class="odd"
                tal:define="is_group python:entry['type'] == 'group'"
                tal:attributes="class python:repeat['entry'].odd and 'odd' or 'even'">
                <td>
                    <img tal:condition="is_group" tal:replace="structure context/group.gif" /> 
                    <img tal:condition="not:is_group" tal:replace="structure context/user.gif" /> 
                    <span tal:replace="entry/title" />
                    <input
                        type="hidden"
                        name="entries.id:records"
                        tal:attributes="value entry/id"
                        />
                    <input
                        type="hidden"
                        name="entries.type:records"
                        tal:attributes="value entry/type"
                        />
                </td>
                <td tal:repeat="role available_roles">
                    <tal:block define="entry_role python:entry['roles'][role['id']]">
                        <img tal:condition="python:entry_role is None" tal:replace="structure context/confirm_icon.gif">
                        <tal:block condition="python:entry_role is not None">
                            <input
                                type="checkbox"
                                value="True"
                                tal:attributes="name string:entries.role_${role/id}:records;
                                                checked python:entry_role == True and 'checked' or None"
                                />
                        </tal:block>
                    </tal:block>
                </td>
            </tr>
        </tal:entries>
    </tbody>
    
    <!-- Items to note about this section:
         - The placeholder text should of course disappear when the field is selected 
           (I have asked Florian to come up with a generic solution to this).
         - I have placed a noscript tag around the submit button, since it is only
           supposed to be there when the user agent doesn't have JS, but feel free
           to enable to test form functionality in the meantime. -->
    <tfoot style="border-top: 1px solid #8CACBB; background-color: #DEE7EC; text-align: center"><!-- XXX: Move to CSS -->
        <tr>
            <td tal:attributes="colspan num_columns">
                <label for="user-group-search">
                    <img tal:replace="structure context/add_alternative_icon.gif" />
                </label>
                <input type="text" 
                       id="user-group-search"
                       size="30" 
                       style="color: #666" 
                       name="search_term"
                       value="Type here to add user/group" />
                <input type="submit" 
                       name="form.button.Search"
                       value="Search"
                       class="searchButton" />
            </td>
        </tr>
    </tfoot>
</table>

<div class="field"
        tal:define="user_results view/user_search_results;
                    group_results view/group_search_results;"
        tal:condition="python:user_results or group_results">
    <table class="listing">
        <thead>
            <tr>
                <th class="nosort">User or group</th>
            </tr>
        </thead>
        <tbody>
            <tr tal:repeat="user user_results">
                <td>
                    <input
                        type="checkbox"
                        name="add_users:list"
                        tal:attributes="value user/id"
                        />
                    <img tal:replace="structure context/user.gif" />
                    <span tal:replace="user/title" />
                </td>
            </tr>
            <tr tal:repeat="group group_results">
                <td>
                    <input
                        type="checkbox"
                        name="add_groups:list"
                        tal:attributes="value group/id"
                        />
                    <img tal:replace="structure context/group.gif" />
                    <span tal:replace="group/title" />
                </td>
            </tr>
        </tbody>
    </table>

    <div>
        <input type="submit" 
               name="form.button.Add"
               value="Add selected"
               class="context" />
    </div>

</div>

<div class="field">
    <input class="noborder"
           type="checkbox"
           name="inherit:boolean"
           value="1"
           checked="checked"
           id="inherit"
           tal:attributes="checked python:view.inherited() and 'checked' or None"
           /> 
    <label for="inherit" i18n:translate="label_inherit_local_roles">
    Inherit permissions from higher levels
    </label>
    <div class="formHelp" i18n:translate="help_inherit_local_roles">
        By default, permissions from the container of this item are inherited.
        If you disable this, only the explicitly defined sharing permissions will
        be valid.
        In the overview, the symbol <img tal:replace="structure context/confirm_icon.gif" />
        indicates an inherited value.

    </div>
</div>

    <input class="context" type="submit" name="form.button.Save" value="Save" />
    <input class="standalone" type="submit" name="form.button.Cancel" value="Cancel" />

</form>

</div>
</body>
</html>
